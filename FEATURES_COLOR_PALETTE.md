# 拼豆颜色合并与多色板支持功能

## 功能概述

本次更新为 PixelBead 添加了以下新功能：

1. **合并相似色号**：基于颜色距离算法自动合并相似的颜色
2. **多色板支持**：提供多种预设色板（168色、144色、96色、48色）
3. **多品牌色号系统**：支持 MARD、COCO、漫漫、盼盼、咪小窝等品牌
4. **颜色映射**：根据选择的色板系统自动映射颜色到对应的色号

## 新增文件

### `utils/colorSystemUtils.ts`
核心颜色处理工具函数，包括：
- `colorDistance()`：计算两种颜色之间的距离（基于HSL色彩空间）
- `mergeSimilarColors()`：根据阈值合并相似颜色
- `mapColorsToPalette()`：将画布颜色映射到指定色板
- `findClosestColor()`：查找与目标颜色最接近的色板颜色
- `sortColorsByHue()`：按色相排序颜色
- `createPaletteFromGrid()`：从画布提取色板

### `colorSystemMapping.json`
包含多品牌色号映射数据的JSON文件，涵盖：
- MARD 色号系统
- COCO 色号系统
- 漫漫色号系统
- 盼盼色号系统
- 咪小窝色号系统

## 使用方法

### 1. 选择色板预设
在左侧边栏找到"色板设置"区域，点击展开：
- **全色板**：使用所有可用颜色
- **168色/144色/96色/48色**：限制颜色数量
- **自定义**：手动控制颜色数量

### 2. 选择色号系统
从下拉菜单选择你使用的品牌：
- MARD
- COCO
- 漫漫
- 盼盼
- 咪小窝

### 3. 调整合并阈值
滑动合并阈值滑块：
- **阈值越高**：合并越多相似颜色，减少颜色数量
- **阈值越低**：保留更多颜色细节
- 范围：0% - 50%

### 4. 显示/隐藏色号
勾选"显示色号"复选框：
- 在颜色统计区域显示色号而非十六进制值
- 在导出图片中显示色号标识

### 5. 执行颜色合并
点击"合并相似颜色"按钮：
- 系统将根据当前阈值合并相似颜色
- 确认后画布将被更新
- 操作可撤销

## 技术实现

### 颜色距离计算
使用 HSL 色彩空间计算颜色差异：
- 色相（H）：占权重 2
- 饱和度（S）：占权重 1
- 明度（L）：占权重 3

### 合并算法
1. 遍历所有颜色
2. 找出与当前颜色距离小于阈值的颜色组
3. 使用使用量最多的颜色作为代表色
4. 将颜色组中所有颜色合并为代表色

### 颜色映射
1. 从 colorSystemMapping.json 加载色号映射
2. 根据选择的色板系统查询对应色号
3. 在UI和导出时使用色号而非hex值

## 注意事项

1. **合并操作不可逆**：请确保在合并前保存好原始设计
2. **阈值调整**：建议从小到大逐步调整，找到最佳平衡点
3. **色号系统**：不同品牌的色号可能略有差异，请选择你实际使用的品牌
4. **颜色数量**：选择预设色板时，如果当前颜色超过限制，会提示是否自动合并

## 未来扩展

- 支持自定义色板导入/导出
- 添加更多品牌色号系统
- 智能颜色合并建议
- 颜色使用率分析报告
